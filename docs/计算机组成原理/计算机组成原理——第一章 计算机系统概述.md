# 计算机组成原理——第一章 计算机系统概述

**知识点整理：**

![](https://i.loli.net/2021/06/13/uoWh94PvZf1YUwa.png)

### 1.计算机发展历程

##### 1.1 计算机四代变化

* 第一代：电子管时代（1946-1957）。逻辑元件使用**电子管**，使用机器语言进行编程；
* 第二代：晶体管时代（1958-1964）。逻辑元件采用**晶体管**，软件开始使用高级语言，有了操作系统的雏形。
* 第三代：中小规模集成电路时代（1965-1971）。逻辑元件采用**中小型集成电路**。高级语言迅速发展，操作系统叶进一步发展，开始有了分时操作系统。
* 第四代：超大规模集成电路时代（1972-至今）。逻辑元件采用**大规模集成电路和超大规模集成电路**，产生了微处理器；

##### 1.2 计算机元件更新换代

* 摩尔定律；
* 半导体存储器的发展；
* 微处理器的发展。**微型计算机发展**以微处理器技术为标志。

##### 1.3 计算机软件的发展

* **计算机语言** 

  ​    经历了面向机器的**机器语言**和**汇编语言**、面向问题的**高级语言**。

<center>高级语言  -(编译)->  汇编语言   -(汇编)->  机器语言</center>

​	翻译程序的特点是翻译一句执行一句，边翻译边执行；由高级语言转化为汇编语言的过程称为**编译**，把汇编语言源程序翻译成机器语言程序的过程称为**汇编**。		

* **操作系统**

  ​    直接影响计算机系统性能提升的各种系统软件也有了长足发展。如：WIndows、UNIX、Linux等。



##### 1.4 计算机分类与发展方向

**电子计算机**

​	电子计算机可以分为下面两种：

* **电子模拟计算机**

* **电子数字计算机**。

  数字计算机又可以按用途分为下面两种

  * 专用计算机；
  * 通用计算机（又可分为巨型机、大型机、小型机、微型机、单片机6类，它们的体积、功耗、性能、数据存储量、指令系统和复杂度和价格依次递减）；

  ​    这是根据计算机的效率、速度、价格以及运行的经济性和适用性来划分的。



**计算机按指令和指令流分类**

* 单指令和单数据流系统（SISD），即传统冯·诺依曼体系结构；
* 单指令和多数据流系统（SIMD），包括阵列处理器和向量处理器系统。
* 多指令和单数据流系统（MISD），这种计算机实际上不存在；
* 多指令和多数据流系统（MIMD），包括多处理器和多计算机系统；



**计算机发展趋势正向“两级”分化**

* 一级是“微型机”向更微型化、网络化、高性能、多用途方向发展。
* 另一级是巨型机向更巨型化、超高速、并行处理、智能化方向发展；



### 2. 计算机系统层次结构

计算机系统由**软件系统**和**硬件系统**的组成：

* **硬件：**指有形物理设备，是计算机系统中实际物理装置的总称；
* **软件：**指在硬件上运行的程序和相关的数据及文档。

#### 2.1 计算机硬件基本组成

##### 2.1.1 早期冯·诺伊曼机

​	冯·诺伊曼机在研究EDVAC机时提出了**“存储程序”**的概念，“存储程序”的思想奠定了现代计算机的基本结构，以此概念为基础的各类计算机统称为冯·诺伊曼机，特点如下：

* 计算机硬件系统由**计算器**、**存储器**、**控制器**、**输入设备**和**输出设备**5大部件组成；
* 指令和数据以同等地位存储在存储器中，并按地址寻访；
* **指令和数据均用二进制代码表示**；
* **指令由操作码和地址码组成**。操作码用来表示操作的性质，地址码用来表示操作数在存储器中的位置；
* **指令在存储器内按顺序存放**。通常，指令是顺序存放的，在特定条件下根据运算结果或根据设定的条件改变；
* **早期冯·诺伊曼机以运算器为中心**，输入/输出设备通过运算器与存储器进行数据传输；

![](https://i.loli.net/2021/05/16/3BTJbADF4GM2gHE.jpg)

##### 2.1.2 现代计算机组织结构

​    随着微电子技术进步，同时计算需要处理、加工的信息量也日益剧增，大量I/O设备的速度和CPU速度差距悬殊，因此以运算器为中心的结构不能满足计算机发展需求。

​	现代计算机已经发展为以**存储器**为中心，使I/O操作尽可能绕过**CPU**，直接在I/O设备和存储器之间完成。

![](https://i.loli.net/2021/05/16/anTKiIyWojBLz7x.jpg)

目前，绝大多数现代计算机仍遵循冯·诺伊曼存储程序的设计思想。

##### 2.1.3 计算机功能布局

* **输入设备**：将程序和数据以机器所能识别和接受的信息形式输入计算机；

* **输出设备**：将计算机处理结果以人们所能接受的形式或其他系统所要求的信息形式输出；

* **存储器**：用来存放程序和数据。

  存储器分为`主存储器`（称为主存，也称内存储器）和`辅助存储器`。

  * CPU直接访问的存储器是主存储器；
  * 辅助存储器中的信息必须调入主存后，才能为CPU所访问；

  ​    **主存储器**  由多个`存储单元`组成，每个存储单元包含若干`存储元件`，每个存储元件存储一位二进制代码“0”和“1”。

  ​    因此，存储单元可存储的一串二进制代码，称这穿代码为`存储字`，称这串代码的位数为`存储字长`，存储字长可以是1B(8bit)或是字节的偶数倍。

  ​	主存储器的工作方式是**按存储单元的地址进行存取**，这种存取方式称为`按地址存取方式（相联存储器是按内容访问的）`。

  ​	主存储器基本组成如下:

  ![](https://i.loli.net/2021/06/13/j2cyknvIb3qgGtN.png)

  * `存储体`中存放二进制信息；
  * `地址存储器（MAR）`存放地址信息，经过地址译码后找到所选的存储单元。
  * `数据寄存器（MDR）`用于暂存要从存储器中读或写的信息，
  * `时序控制逻辑`用于产生存储器操作所需的各种时序信号。

  ​    MAR用于寻址，其**位数对应着存储单元个数**，如MAR为10位，则有2<sup>10</sup>=1024个存储单元，记为1K。MAR长度与PC的长度相等。

  ​	MDR的**位数和存储字长相等**。

  注：MAR与MDR虽然是存储器的一部分，但在现代CPU中却是存在于CPU中的，高速缓冲(Cache)也存在于CPU中。

* 运算器

  ​    运算器是计算机的执行部件，用于进行**算术运算**和**逻辑运算**。
  
  ​	运算器的核心是**算术逻辑单元（Arithmetic and Logical Unit，ALU）**。
  
  ​    运算器包含若干通用寄存器，用于暂存操作数的中间结果，如`累加器(ACC)`、`乘商寄存器(MQ)`、`操作数寄存器(X)`、`变址寄存器(IX)`、`基址寄存器(BR)`等，其中前3个寄存器是必须有的。
  
  ​    运算器内还有`程序状态寄存器(PSW)`,也称为`标志寄存器`,用于存放ALU运算得到的一些标志信息或处理机状态信息，如结果是否溢出、有无产生进位或错位、结果是否为负等。
  
* 控制器

  ​    控制器是计算机的指挥中心，由其“指挥”各部件自动协调地进行工作。控制器由`程序计数器(PC)`、`指令寄存器（IR）`、`控制单元（CU）`组成。

  * `程序计数器(PC)`：用来存放当前与欲执行指令地址，可以自动加1以形成下一条指令地址，它与主存的MAR直接有一条直接通路；
  * `指令寄存器（IR）`：用来存放当前指令，其内容来自主存的`MDR`。指令中的操作码`OP(IR)`送至`CU`,用以**分析指令并发出各种微操作命令序列**；而地址码`Ad(IR)`送往`MAR`，用以**取操作数**。



​    一般**运算器**和**控制器**集成在同一芯片上，称为**中央处理器(CPU)**。**CPU**和**主存储器**共同构成**主机**，而**除主机外的其他硬件装置**(外存、I/O设备等)统称为**外部设备**，简称为外设。

![](https://i.loli.net/2021/05/17/9zuQBTcKjXStGxM.png)

​    上图为冯·诺伊曼结构的模型机。CPU包含`ALU`、`通用寄存器组(GPRs)`、`标志寄存器`、`控制器`、`指令寄存器(IR)`、`程序计数器(PC)`、`存储器地址寄存器(MAR)`和`存储器数据寄存器(MDR)`。

​	图中的虚线就是控制信号，可以控制如何修改PC以得到下一条指令地址，可以控制ALU执行什么运算，可以控制主存是进行读操作还是进行写操作（读/写信号控制）。

​	CPU和主存是靠一组总线相连。总线有**地址**、**控制**和**数据**3组信号线。

* **地址线**：MAR中的地址信息会直接送到地址线上，用于指向读/写操作的主存存储单元；
* **控制线/数据线**：控制线中有读/写信号线，指出数据是从CPU写入主存还是从主存读出到CPU，根据是读操作还是写操作来控制将MDR中的数据是直接送到数据线上还是将数据线上的数据接收到MDR中；

#### 2.2 计算机软件基本组成

##### 2.2.1 计算机软件分类

按功能分类，可以分为**系统软件**和**应用软件**。

* **系统软件**：保证计算机系统高效、正确运行的基本软件，通常作为系统资源提供给用户使用。系统软件主要有`操作系统(OS)`、`数据库管理系统(DBMS)`、`语言处理程序`、`分布式软件系统`、`网络软件系统`、`标准库程序`、`服务性程序`等。
* **应用软件**：指用户为解决某个领域中的各类问题而编制的程序，如各种学科计算类程序、工程设计类程序、数据统计与处理程序等。

##### 2.2.2 三个级别的语言

​	1）**机器语言**。又称二进制代码语言，需要编程人员记忆每条指令的二进制编码。机器语言**是计算机唯一可以直接识别和执行的语言**；

​	2）**汇编语言**。汇编语言用英文单词或缩写代替二进制的指令代码，更容易为人们记忆和理解。使用汇编语言编辑程序，必须经过一个称为**汇编程序**的系统软件的翻译，将其转化为机器语言后才能在计算机硬件系统上执行。

​	3）**高级语言**。（如C、C++等）是为了方便程序设计人员写出解决问题的处理方案和解题过程的程序。通常高级语言需要**经过编译程序编译成汇编语言程序，然后经过汇编操作得到机器语言程序**，或**直接由高级语言程序翻译成机器语言程序**。

### 2.3 计算机的运作过程

计算机工作过程分为以下三步：

* 把程序和数据装入主存储器；
* 将源程序转换为可执行文件；
* 从可执行文件的首地址开始逐条执行指令；

**从源程序到可执行文件**

​	在计算机中编写的C程序必须转换成一系列低级的机器指令，这些指令按照一种称为可执行目标文件格式打包好，并以二进制磁盘文件的形式存放起来。

​	以UNIX系统中的GCC编译器程序为例，读取程序文件`hello.c`,并把它翻译成一个可执行的目标文件`hello`，整个翻译过程可分为4个阶段，如下图：

![](https://i.loli.net/2021/05/18/1GmMncpLEtS7TvD.png)

* **预处理阶段：**预处理器（cpp）对源程序中以字符#开头的命令进行处理，例如将`#include`命令后的`.h文件`内容插入程序文件。输出结果是一个一`.i`为扩展名的源文件；

* **编译阶段：**编译器(ccl)对预处理后的源程序进行编译，生成一个汇编语言源程序`hello.s`；

* **汇编阶段：**汇编器(as)将`hello.s`翻译成机器语言指令，把这些指令打包成一个称为可重定位的目标文件`hello.o`，它是一种二进制文件，因此在文本编辑器中打开它会显示乱码；

* **链接阶段：**链接器(ld)将多个可重定位的目标文件和标志库函数合并为一个可执行目标文件，或简称为可执行文件。

  在本例中，链接器`hello.o`和标准库函数`printf`所在的可重定位目标模块`prinft.o`合并，生成可执行文件`hello`。最终生成的可执行文件被保存在磁盘上。

**指令执行过程的描述**

​	程序中第一条指令地址置于PC中，根据PC取出第一条指令，经过译码、执行步骤等，控制计算机各功能部件协同运行，完成这条指令等功能，并计算下一条指令的地址。

​	用新得到的指令地址读出第二条指令并执行，直到程序结束为止。

​	下面先简单的取指令（即将指令地址码指示的存储单元中的操作数取出后送至运算器ACC中）为例说明：

* 取指令：**PC→MAR→M→MDR→IR**

  ​	根据`PC`取指令到`IR`。将`PC`内容送到`MAR`,`MAR`中的内容直接送到`地址线`，同时`控制器`将读信号送读/写信号线，从指令存储单元读出指令，送到`数据线`上,`MDR`从数据线接收指令信息，并传送到`IR`中；

* 分析指令：**OP(IR)→CU**

  ​	指令译码并送出控制信号。控制器根据`IR`中指令的操作码，生成相应的控制信号，送到不同的执行部件。

  ​	在本例中，`IR`中是取数指令，因此读控制信号被送到总线的控制线上。

* 执行指令：**Ad(IR)→MAR→M→MDR→ACC**

  ​	取操作数。将`IR`中的指令的地址码送到`MAR`,`MAR`中的内容送地址线，同时控制器将读信号送读/写信号线，从主存指定存储单元读出操作数，并通过数据线送到`MDR`，再传到`ACC`中。

  ​	每取完一条指令，还要取出下一条指令做准备，形成下一条指令的地址，即**(PC)+1→PC**。

> （PC）指计数器PC中存放的内容。PC→MAR应理解为(PC)→MAR,即程序计数器中的值经过数据通路送到MAR中，也即表示数据通路时括号内可省略（只强调数据流经过途径，不强调数据本身流动）。但运算时括号不能参略，即（PC）+1→PC不能写为PC+1。

### 2.4 计算机系统的多级层次结构

<img src="https://i.loli.net/2021/05/18/nb3z9vYEdarx2lh.png" style="zoom: 50%;" /><img src="https://i.loli.net/2021/06/09/Rkg3wSBDMpyWEuZ.png" style="zoom: 30%;" />

* 第1级 **微程序机器层**：这是一个硬件层，由机器硬件直接执行微指令；
* 第2级 **传统机器语言层**：它也是一个实际的机器层，由微程序解释机器指令系统；
* 第3级 **操作系统层**：由操作系统实现，操作系统程序是由机器指令和广义指令组成，这些广义指令是为了扩展了机器功能而设置，由操作系统定义解释软件的指令，这一层称为混合层；
* 第4级 **汇编语言层**：为用户提供一种符号化语言，借此可编写汇编语言源程序；
* 第5级 **高级语言层：**面向用户，方便用户编写程序而设置的。该层由各种高级语言编译程序支持和执行。

​        通常，把没有配置软件的纯硬件系统称为“裸机”。第3层～第5层称为**虚拟机**），简单来说就是**软件实现的机器**。

​	随着超大规模集成电路技术的不断发展，**部分软件功能将由硬件来实现**，因此软/硬件交界面的划分也不是绝对的。

​	而本课程主讨论的是**传统机器M1**和**微程序机器M0**的组成原理及设计思想。

### 2.5 计算机的性能指标

##### 2.5.1 主要性能指标

* **机器字长**

  ​	是<u>指计算机进行一次整数运算（即定点整数运算）所能处理的**二进制数据的位数**</u>，通常与CPU的寄存器位数、加法器有关。因此，机器字长一般等于内部寄存器的大小，字长越长，数的表示范围越大，计算的精准度越高。

  ​	计算机字长通常选定为字节（8位）的整数倍。

  > 注意区分**机器字长**、**指令字长**和**存储字长**的关系。

* **数据通路宽带**

  ​	数据通路宽带数<u>指数据总线一次所能并行传送信息的位数</u>。这里所说的数据通路宽度指外部数据总线的宽度，它与CPU内部数据总线宽度（内部寄存器大小）有可能不同。

  > ​    各个子系统通过数据总线连接形成的数据传送路径称为数据通路。

* **主存容量**

     主存容量是<u>指主存储器所能存储信息的最大容量</u>，通常以字节来衡量，也可以用`字数×字长`（512K×16位）来表示存储容量。

  ​	其中，`MAR`的位数反映存储单元个数，`MAR`的位数反映可寻址范围的最大值（而不一定是实际存储器的存储容量）。

  ​	例如，`MAR`为16位，表示2<sup>16</sup>=65536，即存储体内有65536个存储单元（可称为64K内存，1K=1024），若地址寄存器`MDR`为32位，表示存储器的容量为64K×32位。
  
* **运行速度**

     * 吞吐量和响应时间

       **吞吐量：**<u>指系统在单位时间内处理请求的数量</u>。它取决于信息能多快的输入内存，CPU能多快的取指令，数据能多快的从内存取出或存入，以及所得结果能多快的从内存送给一台外部设备。**因此系统吞吐量主要取决于主存的存取周期**。

       

       **响应时间：**<u>指从用户向计算机发送一个请求，到系统对该请求做出响应并获得所需结果对等待时间</u>。

     * 主频和CPU周期

       **CPU时钟周期：**通常为节拍脉冲或T周期，即**主频的倒数**。它是**CPU最小时间单位**，每个动作至少需要1个时钟周期。

       

       **主频（CPU时钟频率）：**机器内部主时钟的频率，是衡量机器速度的重要参数。对于同一型号计算机，主频**越高**，完成指令的一个执行步骤**所用时间越短**，执行指令**速度越快**。

       常用CPU主频有：1.8GHz、2.4GHz、2.8GHz等。

       > CPU时钟周期=1/主频，主频通常以Hz为单位，**1Hz表示每秒一次**。

       

       **CPI：**<u>执行一条指令所需的时钟周期数。</u>

       

       **CPU执行时间：**<u>指运行一个程序所花费的时间</u>。
       $$
       CPU执行时间=CPU时钟周期数/主频=（指令条数×CPI）/主频=（指令条数×CPI）×CPU时钟周期
       $$
       ​    可见，CPU性能（CPU执行时间）主要取决于三个因素：（1）主频 ； （2）每条指令执行时所需的时钟周期（CPI）；(3) 指令条数；

       > 这三个因素往往是相互制约的，例如，更少的指令集可以减少程序所含的指令条数，但可能引起CPU结构的调整，从而增加时钟周期的宽度（降低主频）。

     * MIPS、MFLOPS、GFLOPS和TFLOPS

       **MIPS：**即每秒执行多少百万条指令。
       $$
       MIPS=指令条数/（执行时间\times10^6）=主频/CPI
       $$
       

       **MDLOPS：**即每秒执行多少十亿次浮点运算。
       $$
       MDLOPS=浮点操作次数/（执行时间\times10^6）
       $$
       **GFLOPS：**即每秒执行多少十亿次浮点运算。
       $$
       GDLOPS=浮点操作次数/（执行时间\times10^9）
       $$
       **TFLOPS：**即每秒执行多少十亿次浮点运算。
       $$
       TFLOPS=浮点操作次数/（执行时间\times10^{12}）
       $$

       > 注：描述存储容量时、文件大小时，K、M、G、T通常用2的幂次表示，如1Kb=2<sup>10</sup>b。在描述速率、频率时，k、M、G、T通常用10的幂次表示，如1kb/s=10<sup>3</sup>b/s。前者用大写的K，后者用小写的k。

##### 2.5.2 几个专业术语

* 系列机：具有基本相同的体系结构。使用**相同基本指令系统**的多个不同型号计算机组成的一个产品系列。
* 兼容：指计算机软件或硬件的通用性，即使用或运行某个型号的计算机系统中的硬件/软件也能应用于另一个型号的计算机系统时，称这两台计算机在硬件/软件上存在兼容性。
* 固件。将程序固定在ROM中的组成部件称为固件。
