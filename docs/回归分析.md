# 回归分析

## 1.概念

​	回归分析:的任务是**通过研究自变量X与因变量Y的相关关系,尝试去解释Y的形成机制,进而达到通过X去预测Y。**

通过划分因变量Y的类型,常见的回归分析有5类:

①线性回归	②0-1回归	③定序回归	④计数回归	⑤生存回归

## 2.回归思想

### 2.1 三个关键词：

回归分析:研究**X**和**Y**之间**相关性的分析**。

**相关性：**

首先，相关性≠因果性。

例如，统计数据：游泳死亡人数与雪糕销量 → 结果：游泳死亡人数和雪糕销量之间呈显著正相关，即游泳死亡人数越高，雪糕卖得越多。**（相关性结论）**

但不能从结果中得到结论：吃雪糕会增加游泳死亡的风险。**（因果性结论）**

回归分析只能用来探究各种因素之间的相关性。

**Y(因变量)：**

因别人改变而改变的变量,在实际应用中需要探究的核心变量。

> 例如：
>
> （1）经济学家研究经济增长的决定因素，那么Y可以选取GDP增长率。**（连续数值型变量）**
> （2）P2P公司要研究借款人是否能按时还款，那么Y可以设计成一个二值变量，Y=0时代表可以还款，Y=1时代表不能还款。**（0‐1型变量）**
> （3）消费者调查得到的数据（1表示非常不喜欢，2表示有点不喜欢，3表示一般般，4表示有点喜欢，5表示非常喜欢）。**（定序变量）**
> （4）管理学中RFM模型：F代表一定时间内，客户到访的次数，次数其实就是一个非负的整数。**（计数变量）**
> （5）研究产品寿命、企业寿命甚至是人的寿命（这种数据往往不能精确的观测，例如现在要研究吸烟对于寿命的影响，如果选取的样本中老王60岁，现在还活的非常好，我们不可能等到他去世了再做研究，那怎么办呢？直接记他的年龄为60+，那这种数据就是截断的数据）。**（生存变量）**

**X(自变量)：**
用来解释Y的相关变量。


**例题：**

【例一】下表为1990-2007年中国棉花单产与要素投入表格，请用回归的方法指出哪个要素投入是最重要的要素。

![](https://i.loli.net/2021/01/30/Kn2ovgxrzQG7EsJ.png)

Y为连续型变量，所以可以采用线性回归方法。

【例二】研究借款人是否能借款成功与借款人是否能按时还款。

<img src="https://i.loli.net/2021/01/30/VSBGweN5rg6xpsf.png" style="zoom:80%;" />

​	从借款人的角度，探究是否借款成功，则选取SUCCESS作为Y；从贷款人的角度，探究借款后是否违约，则选取DEFAULT作为Y。（在回归分析中Y只能有一个，所以需要从不同研究角度来选取Y）

其中，Y为0-1变量，所以可采用0-1回归方法。



### 2.2 三个任务：

**识别重要变量：** 回归分析需要去识别并判断：**哪些X变量是同Y真相关，哪些不是。**

​	统计学中有一个非常重要的领域，叫做“变量选择”，判断X中哪些有用哪些没有。例如逐步回归法，即将X逐个分析，显著就留下，否则舍弃。

**判断相关性方向：** 回归分析分析还需要去探究：**这些有用的X变量同Y的相关关系是正还是负。**

**估计权重（回归系数）：** **赋予不同X不同权重，即不同回归系数，进而可以知道不同变量之间的相对重要性。**其中还有一个非常重要的步骤，**去除量纲处理**。

## 3.回归分析分类

![](https://i.loli.net/2021/01/30/jxWlt2IZAOJd9TQ.png)

## 4.线性回归

### 4.1 不同数据类型处理方法

![](https://i.loli.net/2021/01/30/vL6et7CuWKfcpB5.png)

**横截面数据：**在某一时间点收集不同对象的数据。

> 例如：
> （1）我们自己发放问卷得到的数据
> （2）全国各省份2018年GDP的数据
> （3）大一新生今年体测的得到的数据

**时间序列数据：**同一对象在不同时间连续观察所得到的数据。

> 例如：
> （1）从出生到现在，你的体重的数据（每年生日称一次)。
> （2）中国历年来GDP的数据。
> （3）在某地方每隔一小时测得的温度数据。

**面板数据：**横截面数据与时间序列数据综合起来得到的一种数据资源。面板类数据较为复杂，是在中级计量经济学中才会学到的模型。

> 例如：
> 2008‐2018年，我国各省份GDP的数据。

### 4.2 一元线性回归模型

![](https://i.loli.net/2021/01/30/smqxXDipUQ3JWfS.png)

推导过程，最小二乘法：

![](https://ae01.alicdn.com/kf/U0c3bd87fa30449dc9e9687fbcffbc2ebx.jpg)

比较一元线性函数拟合：

![](https://i.loli.net/2021/01/30/b6WoA8FU5dISvyp.png)

![](https://i.loli.net/2021/01/30/pUy4KrDXEOdwiQv.png)

![](https://i.loli.net/2021/01/30/OL697viyE4ZGWHA.png)

​	**拟合和回归，只是概念上有所不同，本质上还是一样的**，目的都是为了使得最后的残差平方和最小。

准确来说，两者差别：

> ​	曲线拟合问题的特点是，根据得到的若干有关变量的一组数据，寻找因变量与（一个或几个）自变量之间的一个函数，使这个函数对那组数据拟合得最好。通常，函数的形式可以由经验、先验知识或对数据的直观观察决定，要作的工作是由数据用最小二乘法计算函数中的待定系数。
>
> ​	而从数理统计的观点看，这里涉及的都是随机变量，我们根据一个样本计算出的那些系数，只是它们的一个（点）估计，应该对它们作区间估计或假设检验，如果置信区间太大甚至包含了零点，那么系数的估计值是没有多大意义的。另外也可以用方差分析方法对模型的误差进行分析，对拟合的优劣给出评价。
>
> 简单地说，**回归分析就是对拟合问题作的统计分析**。



**对于线性的理解：**

在上述模型的假设中，

![](https://i.loli.net/2021/01/30/O1Ik3MsWNqfApZC.png)

但注意在线性假设中，并不要求初始模型都呈上述的严格线性关系，自变量与因变量可通过变量变换而转化成线性模型，例如：

![](https://i.loli.net/2021/01/30/sNz75mMnlWRoE1b.png)



## 5.回归系数的解释

### 5.1基本解释

**一元回归模型:**
$$
y_i=\beta _0+\beta _1x_i+\mu _i
$$
其中，β<sub>0</sub>和β<sub>1</sub>为回归系数。

假设x为某产品品质评分（1-10之间），y为该产品的销量，我们对x和y使用一元线性回归模型。

假设得到结果为：
$$
\widehat{y_i}=3.4+2.3x_i
$$
对其进行解释:

* 3.4:在评分为0时,该产品的平均销量为3.4;
* 2.3:在评分每增加一个单位,该产品的平均销量增加2.3;



**多元回归模型:**

在上述一元回归模型中继续添加一个变量
$$
y_i=\beta \_0+\beta \_1x\_{1i}+\beta \_2x\_{2i}+\mu \_i
$$
其中有两个自变量,假设x<sub>1</sub>表示品质评分,x<sub>2</sub>表示该产品的价格。

假设得到结果为：
$$
\widehat{y_i}=5.3+2.3x_{1i}-1.74x_{2i}
$$

* 5.3:在评分为0且价格为0时,该产品的平均销量为5.3个;
* 0.19:在保持其他变量不变的情况下,评分每增加一个单位,该产品平均销量增加0.19;
* -1.74:在保持其他变量不变的情况下,价格每增加一个单位,该产品平均销量减少1.74;

![](https://i.loli.net/2021/01/31/scnE7X8YMQm1AiN.png)

对比上面两个模型可以看出,引入一个新的变量后,对回归系数影响非常大。

其原因为：**遗漏变量导致内生性**。


### 5.2 内生性探究

假设模型为：

$$
y_i=\beta \_0+\beta \_1x{1i}+\beta \_2x_{2i}+...+\beta \_kx\_{ki}+\mu \_i
$$

​	u为无法观察且满足一定条件的扰动项。如果满足**误差项u和所有的自变量x均不相关**，则称该模型具有**外生性**。

​	反之如果相关，则存在**内生性**，这样会导致回归系数估计的不准确：不满足无偏性和一致性。

回到刚刚的例子：
$$
y_i=\beta _0+\beta _1x_i+\mu _i
$$
β<sub>0</sub>和β<sub>1</sub>为回归系数,x为该产品品质评分（1-10之间），y为该产品的销量。

那么模型中误差项μ<sub>i</sub>则包含了**所有与y<sub>i</sub>相关，但未添加到回归模型中的变量，如果这些变量和我们已经添加的自变量相关，则存在内生性。**

​	就如上述多元回归模型，产品的价格x<sub>2</sub>与品质评分x<sub>1</sub>间存在一定的相关性关系，所以就会存在一定内生性问题。

无内生性(no endogeneity)要求所有解释变量均与扰动项不相关。这个假定通常太强，因为解释 变量一般很多且要保证它们全部外生。所以可以弱化此条件：**将解释变量区分为核心解释变量和控制变量。**

* 核心解释变量：我们最感兴趣的变量，因此我们特别希望得到对其系数的一致估计（当样本容量无限增大时，收敛于待估计参数的真值）。
* 控制变量：我们可能对于这些变量本身并无太大兴趣；而之所以把它们放入回归方程，主要是为了“控制住” 那些对被解释变量有影响的遗漏因素。

在实际应用中，我们只要保证核心解释变量与𝝁不相关即可。



而由于内生性本身是一个非常复杂的问题，在数模比赛中，一般不用去考虑。

### 5.3 对解释变量取对数

$$
\\
\widehat{y_i}=\widehat{\beta \_0}+\widehat{\beta \_1}\ln x_{1i}
$$

伍德里奇的《计量经济学导论，现代观点》里，第六章176-177页有详细的论述:**取对数意味着原被解释变量对解释变量的弹性，即百分比的变化而不是数值的变化**；
目前，对于什么时候取对数还没有固定的规则，但是有一些经验法则：

> （1）与市场价值相关的，例如，价格、销售额、工资等都可以取对数；
> （2）以年度量的变量，如受教育年限、工作经历等通常不取对数；
> （3）比例变量，如失业率、参与率等，两者均可；
> （4）变量取值必须是非负数，如果包含0，则可以对y取对数ln(1+y);

**取对数的好处：**

①减弱数据的异方差性	②如果变量本身不符合正态分布，取了对数后可能渐近服从正态分布	③模型形式的需要，让模型具有经济学意义。

### 5.4 四类模型回归系数解释

![](https://i.loli.net/2021/01/31/q7WsP3ptwzNKHQh.png)

![](https://i.loli.net/2021/01/31/AVyv2sPuLx5oRaq.png)

## 6.回归中处理定性变量

### 6.1 虚拟变量

若自变量中存在定性变量,则需要相应的引入虚拟变量:

![](https://i.loli.net/2021/01/31/7PNHMpkKlGj95sx.png)

Female则为引入的虚拟变量。

### 6.2 虚拟变量的解释

**0-1分类虚拟变量解释：**

![](https://i.loli.net/2021/01/31/ViAczTxDX6ZSHNO.png)

**多分类虚拟变量解释：**

如，探讨我国P2P网络贷款中是否存在显著的地域歧视问题？

![](https://i.loli.net/2021/01/31/8n1ktDgM3m9FBXN.png)

![](https://i.loli.net/2021/01/31/8NHYpl15AwUEq7B.jpg)

为了避免完全多重共线性的影响，引入虚拟变量的个数一般是分类数减1。

## 7.回归中处理含有交互性的自变量

price:房价sqrft:住房面积bdrms:卧室数量bthrms:卫生间数量。

![](https://i.loli.net/2021/01/31/IEScMU8YNvgZG91.png)

## 8.案例一：探究婴幼儿奶粉的销售情况

​	现有某电商平台846条关于婴幼儿奶粉的销售信息，每条信息由11个指标组成。其中，评价量可以从一个侧面反映顾客对产品的关注度。
​	请对所给数据进行以下方面的分析，要求最终的分析将不仅仅有益于商家，更有益于宝妈们为宝贝选择适合自己的奶粉。
1) 以评价量为因变量，分析其它变量和评价量之间的关系；
2) 以评价量为因变量，研究影响评价量的重要因素

![](https://i.loli.net/2021/01/31/mODsqKCEQ54UZXL.png)

### 8.1 问题一

1) 以评价量为因变量，分析其它变量和评价量之间的关系；

以下演示使用Stata进行回归分析：

**第一步：导入数据**

```stata
import excel "G:\1.0学习资料\算法模型数据挖掘\数学建模\七.多元回归分析\代码和
> 例题数据\课堂中讲解的奶粉数据.xlsx", sheet("Sheet1") firstrow
```

![](https://i.loli.net/2021/01/31/Znfrh15Ac3OK4Dv.png)

**第二步：描述性统计**

①定量数据:

<center>summarize 变量1 变量2 ... 变量n
</center>

```
summarize 团购价元 评价量 商品毛重kg
```

![](https://i.loli.net/2021/01/31/RhgWOKD3S6det9z.png)

Obs:样本量值;	Mean:均值;	Std.Dev.:标准差;	Min:最小值;	Max:最大值;

②定性数据:

<center>tabulate 变量名,gen(A)</center>

tablate每次只能对一个定性变量进行描述性统计,返回对应的这个变量的频率分布表，并生成对应的虚拟变量(以A开头)。

```
tabulate 配方,gen(A)
tabulate 奶源产地 ,gen(B)
tabulate 国产或进口 ,gen(C)
tabulate 适用年龄岁 ,gen(D)
tabulate 包装单位 ,gen(E)
tabulate 分类 ,gen(F)
tabulate 段位 ,gen(G)
```

![](https://i.loli.net/2021/01/31/pfMhK5tc7rql4FS.png)

如果想将定类数据放到论文中,可以对定类频数做扇形图。(可以不做)

最后,*将描述性统计结果整理表格放入论文*。

![](https://i.loli.net/2021/01/31/OIH8TPzemjYW4No.png)

**第三步：进行回归**

进行回归语句:

<center>regress y x1 x2 … xk</center>

默认使用的OLS：普通最小二乘估计法

例 定量变量分析

```
regress 评价量 团购价元 商品毛重kg
```

![](https://i.loli.net/2021/01/31/eRHXLx4la7nY18z.jpg)

例 加入定性变量分析:

```
regress 评价量 G1-G4
```

![](https://i.loli.net/2021/01/31/WOXfD2mK5V3wpPu.jpg)

综合分析:

```
reg 评价量 团购价元 商品毛重kg A1-G4
```

![](https://i.loli.net/2021/01/31/bgd5T2xRa3v1BVZ.jpg)

保存结果：

```
//ssc install reg2docx, all replace//安装第三方库reg2docx

est store m1 //将上边reg结果保存到m1中

reg2docx m1 using m1.docx,replace //导出结果,得到一个m1.docx文件
```

![](https://i.loli.net/2021/01/31/2qsGOvCB1XWr6Fh.png)

![](https://i.loli.net/2021/01/31/6IwW9HvCrDBu1qz.png)

\*** :p<0.01	** :p<0.05	\* :p<0.1	括号中为T检验值。

可以回答第一问:

1)在90%的置信水平下,团购价元和F1对应的回归系数是显著的。

* 团购价：在其他自变量不变的情况下，团购价每增加一元，会导致评价量平均减少29.77；
* F1（F1为牛奶粉，F2为羊奶粉）：在控制其他自变量不变的情况下，分类为牛奶粉的奶粉的平均评价量要比分类为羊奶粉的评价量要高出14894.55。

其他自变量都不显著所以不用分析。

**拟合优度R<sup>2</sup>较低怎么办：**

* 回归分为解释型回归和预测型回归。

  预测型回归一般才会更看重R<sup>2</sup>,R<sup>2</sup>越大,拟合效果越好。
  解释型回归更多的关注模型整体显著性以及自变量的统计显著性和经济意义显著性即可。

* 可以对模型进行调整，例如对数据取对数或者平方后再进行回归(玄学)。

* 数据中可能有存在异常值或者数据的分布极度不均匀。

**关于拟合优度和调整后的拟合优度:**

​	我们引入的自变量越多，拟合优度会变大。但我们倾向于使用调整后的拟合优度，如果新引入的自变量对SSE的减少程度特别少，那么调整后的拟合优度反而会减小。(放入论文中)

![](https://i.loli.net/2021/01/31/uN5RWMn76xwVb3r.png)

### 8.2 问题二

2) 以评价量为因变量，研究影响评价量的重要因素

* 为了更为精准的研究影响评价量的重要因素（去除量纲的影响），我们可考虑使用标准化回归系数。

* 对数据进行标准化，就是将原始数据减去它的均数后，再除以该变量的标准差，计算得到新的变量值，新变量构成的回归方程称为标准化回归方程，回归后相应可得到标准化回归系数。

* 标准化系数的绝对值越大，说明对因变量的影响就越大（只关注显著的回归系数哦）。

标准化回归命令:

<center>regress y x1 x2 … xk,beta</center>

```
reg 评价量 团购价元 商品毛重kg A1-G4,beta
```

![](https://i.loli.net/2021/01/31/cHmT9iaqWxF8uGg.jpg)

回答问题2)：

团购价的标准化回归系数绝对值要大于F1,所以团购价是影响评价量的最重要因素。

## 9.案例二：探究大学生期末数学成绩影响因素分析

一篇存在问题的论文：

![](https://i.loli.net/2021/01/31/2Hc3mFlv5XWMKYs.png)

![](https://i.loli.net/2021/01/31/KaQt6xFl8SrGYWd.jpg)

![](https://i.loli.net/2021/01/31/mwo6f2Q9eREHcGV.jpg)

## 10.案例三：P2P网络借贷中的地域歧视现象研究

![](https://i.loli.net/2021/01/31/KzyngdFLXBwj1Wp.png)

①数据描述性统计

![](https://i.loli.net/2021/01/31/4Aqa5ulfYZIevrs.png)

​	该表给出了各省份样本数、借贷成功率和违约率的数据。

​	从表中可以 看出，内蒙古的借款成功率最低，仅有 3.4%，江苏的成功率最高，达到了 11.2%; 但是从违约率的角度来看，内蒙古的违约率略低于平均违约率，而江苏的违约率 却略高于违约率。

​	这表明各省份的借款成功率与违约率之间并没有明显的关系，

各省份借贷样本数、成功率和违约率：

![](https://i.loli.net/2021/01/31/tOeGDYRklpPFrKs.png)

使用excel绘图

![image-20210131063752775](https://i.loli.net/2021/01/31/nkDAcCHJdgX1NLt.png)

②模型构建
$$
SUCCESS_i=\alpha +\sum{\beta _n\times Province_n+\lambda \times Controls_i+\varepsilon _i}
$$
![](https://i.loli.net/2021/01/31/qGUQ8sb6wDBEIe2.png)

③回归结果

![](https://i.loli.net/2021/01/31/zRJ62vCqwGBjNpD.png)

![](https://i.loli.net/2021/01/31/lj6RtzyHnMfoVGv.png)

上方的实线是通过统计性描述计算出来的各省份与内蒙古的成功率的相对差。

下方的虚线是回归系数，其实际意义是控制了其他变量（包括借贷合约信息、个人信用、经济与非经济信息）后的相对差。

圆形的实心标记表示该省份的回归系数显著（置信水平为90%）。

④回归结果分析

​	本文对30个省份的系数进行了联合显著性检验，得到的F统计量：F(30,128489)=9.09，对应的p值为0.00，这说明在1%的显著性水平上，P2P借贷市场中存在着地域歧视。

![image-20210131065015770](https://i.loli.net/2021/01/31/RTxYX5glKbLQBEA.png)

## 11.回归模型的扰动项

在回归模型中:
$$
y_i=\beta _0+\beta _1x_{1i}+\beta _2x_{2i}+...+\beta _kx_{ki}+\mu _i
$$
扰动项μ<sub>i</sub>为无法观察且满足一定条件的扰动项。

在之前的回归分析中，都默认了扰动项是球型扰动项：满足“同方差”和“无自相关”两个条件。

![](https://i.loli.net/2021/01/31/3Iji9su8Vvqm7Dh.jpg)

横截面数据往往容易出现异方差的问题；而时间序列数据容易出现自相关问题。

### 11.1 异方差概念

如果扰动项存在异方差：

* OLS估计出来的回归系数是无偏、一致的；
* 假设检验无法使用（构造的t统计量失效了）；
* OLS估计量不再是最优线性无偏估计量（BLUE）；

存在异方差的图：

![](https://i.loli.net/2021/01/31/yCY1ZMLhxfdn4W9.png)

随着x增大，方差不断增大，也就意味着方程在不断改变，存在异方差。

**解决异方差方法：**

* 使用OLS + 稳健的标准误
* 广义最小二乘估计法GLS
  原理：方差较小的数据包含的信息较多（较为重要），我们可以给予信息量大的数据更大的权
  重（即方差较小的数据给予更大的权重）

### 11.2 检验异方差方法

**通过图形检验异方差（较为粗糙）：**

```
rvfplot (画残差与拟合值的散点图）
```

![image-20210131074217987](https://i.loli.net/2021/01/31/EtAlDZLmIRwz39e.png)

随着拟合值的不断增大,数据波动越来越明显,说明存在异方差。

```
rvpplot x (画残差与自变量x的散点图)
```

如 rvpplot 团购价元

![](https://i.loli.net/2021/01/31/ExRfhAeZnWrHcmG.png)

​	当团购价小的时候数据波动比较大,而当团购价足够大的时候数据波动小,则说明存在异方差问题。

**拟合值出现负数的原因：**

在第一张图中，

![image-20210131074217987](https://i.loli.net/2021/01/31/EtAlDZLmIRwz39e.png)

​	横坐标为拟合值，数据中评价量为正数，理论上拟合值也应该为正数，但图像上出现了拟合值为负数的情况。

评价量的概率密度函数：

```
kdensity 评价量
```

![](C:\Users\sn159\AppData\Roaming\Typora\typora-user-images\image-20210131074807654.png)

从概率密度函数图上可看出,评价量分布是极度不均匀的，主要位于评价类很小的区间。

```
sum 评价量,d
```

![](https://i.loli.net/2021/01/31/Ue5jf6EbFPdKucS.png)

有75%的奶粉品牌的评价量小于1100，评价量超过17000的只有10%不到，而样本均值却达到了15800。**这说明评价量的分布极度不平衡**，大多数个体的评价量都较小。从右图中也直观的说明了绝大部分品牌的评价量都较小这一特征。

由于分布不均匀,导致了拟合值的R<sup>2</sup>很小,而且拟合值还会出现负数。

通过图形检验比较除此，除此之外还有两种更准确的检验方法：BP检验、怀特检验。

### 11.3 BP检验

![](https://i.loli.net/2021/01/31/D4C2hX5Sc8quIbl.png)

BP检验在Stata中命令（回归结束后使用）：

```
estat hettest ,rhs iid
```

![](https://i.loli.net/2021/01/31/FzbSlukTE2KV4A1.png)

* 24:为自由度;
* 59.54:对应的卡方分布;
* P:检验值

原假设H<sub>0</sub>：扰动项不存在异方差。

P值小于0.05，说明在95%的置信水平下拒绝原假设，即我们认为扰动项存在异方差。

### 11.4 怀特检验

![](https://i.loli.net/2021/01/31/85JSG4j9ZgPHXRE.png)

Stata命令（在回归结束后使用）：

```
estat imtest,white
```

![image-20210131080748286](https://i.loli.net/2021/01/31/VeiFl4DSmXG7rJk.png)

怀特检验原假设：不存在异方差

P值小于0.05，说明在95%的置信水平下拒绝原假设，即我们认为扰动项存在异方差。

### 11.5 解决异方差

* 使用OLS + 稳健的标准误

如果发现存在异方差，一种处理方法是，仍然进行OLS 回归，但使用稳健标准误。这是最简单，也是目前通用的方法。只要样本容量较大，即使在异方差的情况下，若使用稳健标准误，则所有参数估计、假设检验均可照常进行。换言之，只要使用了稳健标准误，就可以与异方差“和平共处”了。

* 广义最小二乘法GLS

  原理：方差较大的数据包含的信息较少，我们可以给予信息量大的数据（即方差
  较小的数据更大的权重）

  缺点：我们不知道扰动项真实的协方差矩阵，因此我们只能用样本数据来估计，
  这样得到的结果不稳健，存在偶然性。

在大多数情况下应该使用“OLS + 稳健标准误”。

**使用OLS + 稳健的标准误：**

在原来回归的基础上：

<center>regress y x1 x2 … xk,robust</center>

```
reg 评价量 团购价元 商品毛重kg A1-G4,r
```

![](https://i.loli.net/2021/01/31/W6yR8G9C2vFJdIY.png)

![](https://i.loli.net/2021/01/31/lBpW5ztGuyJe3Fn.png)

可以发现显著项变多。

所以在state进行回归之前，先进行异方差检验，若存在异方差，则使用robust对结果进行修正。

## 12.多重共线性

![](https://i.loli.net/2021/01/31/jKLzxpn9USPlcge.png)

**检验多重共线性：**

计算指标，方差膨胀因子VIF。

假设现在有k个自变量，那么第m个自变量的VIF为：
$$
VIF_m=\frac{1}{1-R_{1-k\backslash\text{m}}^{2}}
$$
![](https://i.loli.net/2021/01/31/gz9GRiuFyD2dCUZ.png)

![image-20210131091050679](https://i.loli.net/2021/01/31/Y4e25tfSQ3Nh1Wc.png)

Stata计算各自变量VIF的命令（在回归结束后使用）：

```
estat vif
```

![](https://i.loli.net/2021/01/31/JMBFIuLa7ZbrmUs.png)

框内的指标存在多重共线性问题.

如果发现存在多重共线性，可以采取以下处理方法。

(1)如果不关心具体的回归系数，而只关心整个方程预测被解释变量的能力，则通常可以不必理会多重共线性（假设你的整个方程是显著的）。这是因为，多重共线性的主要后果是使得对单个变量的贡献估计不准，但所有变量的整体效应仍可以较准确地估计。

(2)如果关心具体的回归系数，但多重共线性并不影响所关心变量的显著性，那么也可以不必理会。即使在有方差膨胀的情况下，这些系数依然显著;如果没有
多重共线性，则只会更加显著。

(3) 如果多重共线性影响到所关心变量的显著性，则需要增大样本容量，剔除导致严重共线性的变量（不要轻易删除哦，因为可能会有内生性的影响），或对模型设定进行修改。

**要么不管,要么把存在问题的变量删除.**

## 13.逐步回归

**向前逐步回归:**

将自变量逐个引入模型，每引入一个自变量后都要进行检验，显著时才加入回归模型。

缺点：随着以后其他自变量的引入，原来显著的自变量也可能又变为不显著了，但是，并没有将其及时从回归方程中剔除掉。

Stata语句:

```
stepwise regress y x1 x2 … xk, pe(#1)
```

\#为显著性水平,如果你觉得筛选后的变量仍很多你可以减小#1或者#2；如果你觉得筛选后的变量太少了，你可以增加#1或者#2。

**向后逐步回归:**

先将所有变量均放入模型，之后尝试将其中一个自变量从模型中剔除，看整个模型解释因变量的变异是否有显著变化，之后将最没有解释力的那个自变量剔除；此过程不断迭代，直到没有自变量符合剔除的条件。

缺点：一开始把全部变量都引入回归方程，这样计算量比较大。若对一些不重要的变量，一开始就不引入，这样就可以减少一些计算。(但计算量对计算机来说一般都不是问题)

```
stepwise regress y x1 x2 … xk, pr(#2)
```

此时要注意，采用逐步回归时，x1 x2 … xk之间不能有完全多重共线性，需要手动剔除。

**逐步回归说明：**

（1）向前逐步回归和向后逐步回归的结果可能不同。

（2）不要轻易使用逐步回归分析，因为剔除了自变量后很有可能会产生新的问题，例如内生性问题。

（3）有没有更加优秀的筛选方法？有的，那就是每种情况都尝试一次，最终一共有![image-20210131093138007](https://i.loli.net/2021/01/31/cxSXYsQb6rB2Iiu.png)。但这种全局筛选不现实。

<script type="text/javascript"
  src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
});
</script>
